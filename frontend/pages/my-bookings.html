<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Bookings | Tripeaz Taxi Partners</title>
  <link rel="stylesheet" href="../css/pages/dashboard.css" />
  <link rel="stylesheet" href="../css/pages/my-bookings.css" />
  <link rel="stylesheet" href="../css/pages/post-booking.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap"
    rel="stylesheet" />
</head>

<body>
  <!-- Header -->
  <header class="main-header">
    <div class="header-content">
      <!-- Logo -->
      <div class="header-logo">
        <h2 class="logo-text">Tripeaz Taxi</h2>
        <span class="logo-badge">Partners</span>
      </div>

      <!-- Header Action Buttons -->
      <div class="header-actions">
        <!-- Support Button -->
        <button class="support-button" onclick="handleSupportClick()" aria-label="Support">
          <svg class="support-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 1C7.03 1 3 5.03 3 10V16C3 17.1 3.9 18 5 18H7V12H5V10C5 6.13 8.13 3 12 3C15.87 3 19 6.13 19 10V12H17V18H19C20.1 18 21 17.1 21 16V10C21 5.03 16.97 1 12 1Z" />
            <path d="M9 21H15V23H9V21Z" />
          </svg>
        </button>
      </div>
    </div>
    <div class="header-border"></div>
  </header>

  <!-- Page Header -->
  <div class="bookings-page-header">
    <div class="header-text">
      <h1 class="page-title">My Bookings</h1>
      <p class="page-subtitle">
        Manage your posted bookings and track activity
      </p>
    </div>
    <button class="create-new-btn" onclick="createNewBooking()">
      + Create New Booking
    </button>
  </div>

  <!-- Tabs -->
  <div class="bookings-tabs">
    <button class="tab-btn active" onclick="switchBookingTab('pending')" id="pendingTab">
      Pending
    </button>
    <button class="tab-btn" onclick="switchBookingTab('history')" id="historyTab">
      History
    </button>
  </div>


  <!-- Bookings Container -->
  <main class="bookings-main">
    <!-- Pending Tab Content -->
    <div class="tab-content active" id="pendingContent">
      <!-- Bookings subcategory -->
      <div class="subcategory-content active" id="pendingBookingsContent">
        <!-- Bookings will be loaded dynamically from API -->
      </div>
      <!-- Vehicles subcategory -->
      <div class="subcategory-content" id="pendingVehiclesContent">
        <!-- Vehicles will be loaded dynamically from API -->
      </div>
    </div>

    <!-- History Tab Content -->
    <div class="tab-content" id="historyContent">
      <!-- Bookings subcategory -->
      <div class="subcategory-content active" id="historyBookingsContent">
        <!-- Bookings will be loaded dynamically from API -->
      </div>
      <!-- Vehicles subcategory -->
      <div class="subcategory-content" id="historyVehiclesContent">
        <!-- Vehicles will be loaded dynamically from API -->
      </div>
    </div>
  </main>

  <!-- Footer Navigation -->
  <footer class="footer-nav">
    <nav class="nav-tabs">
      <!-- Tab 1: Booking Available -->
      <button class="nav-tab" data-tab="available" onclick="navigateToTab('available')">
        <div class="tab-icon">ğŸš–</div>
        <span class="tab-label">Available</span>
      </button>

      <!-- Tab 2: My Features -->
      <button class="nav-tab" data-tab="features" onclick="navigateToTab('features')">
        <div class="tab-icon">â­</div>
        <span class="tab-label">Features</span>
      </button>

      <!-- Tab 3: Floating Action Button (FAB) -->
      <button class="nav-tab fab-button" onclick="toggleFABPopup()" id="fabButton" aria-label="Add New Item"
        aria-expanded="false">
        <div class="fab-icon nav-fab-icon">+</div>
      </button>

      <!-- Tab 4: My Bookings -->
      <button class="nav-tab active" data-tab="bookings" onclick="navigateToTab('bookings')">
        <div class="tab-icon">ğŸ“‹</div>
        <span class="tab-label">Bookings</span>
      </button>

      <!-- Tab 5: Profile -->
      <button class="nav-tab" data-tab="profile" onclick="navigateToTab('profile')">
        <div class="tab-icon">ğŸ‘¤</div>
        <span class="tab-label">Profile</span>
      </button>
    </nav>
  </footer>

  <!-- Close Modal (with Assign functionality merged) -->
  <div class="modal-overlay" id="closeModal" onclick="closeCloseModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>Close Booking</h3>
        <button class="close-modal-btn" onclick="closeCloseModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- Step 1: Closed From (Required) -->
        <label class="modal-label">Closed From *</label>
        <select class="modal-input" id="closedFrom" required>
          <option value="">Select platform...</option>
          <option value="tripeaz-taxi-partners">Tripeaz Taxi Partners</option>
          <option value="bhade-ghaadi">Bhade Ghaadi</option>
          <option value="taxi-sanchalak">Taxi Sanchalak</option>
          <option value="cabswale-partners">Cabswale Partners</option>
          <option value="whatsapp">WhatsApp</option>
          <option value="other">Other</option>
        </select>

        <!-- Step 2: Assign To Section (Only for Tripeaz Taxi Partners) -->
        <div id="assignToSection" style="display: none; margin-top: 16px">
          <label class="modal-label">Assign To *</label>
          <input type="text" class="modal-input" id="assignToSearch"
            placeholder="Search by User ID, Name, or Mobile Number..." oninput="searchUsersForAssign(this.value)"
            required />

          <!-- Search Results -->
          <div class="search-results" id="assignToResults" style="max-height: 200px; overflow-y: auto; margin-top: 8px">
          </div>

          <!-- Selected User Display -->
          <div id="selectedUserDisplay" style="
                display: none;
                margin-top: 12px;
                padding: 10px;
                background: #1a1a1a;
                border-radius: 8px;
                border: 1px solid rgba(255, 153, 0, 0.3);
              ">
            <span style="color: #e0e0e0">Selected: </span>
            <span id="selectedUserName" style="color: #ff9900; font-weight: 600"></span>
            <button onclick="clearSelectedUser()" style="
                  float: right;
                  background: transparent;
                  border: none;
                  color: #f44336;
                  cursor: pointer;
                  font-size: 18px;
                  padding: 0 8px;
                ">
              âœ•
            </button>
          </div>
        </div>

        <!-- Step 3: Submit Button -->
        <button class="submit-closure-btn" id="submitCloseBtn" onclick="submitClosure()">
          Close Booking
        </button>
      </div>
    </div>
  </div>


  <!-- Edit Booking Modal -->
  <div class="modal-overlay" id="editBookingModal" onclick="closeEditBookingModal()">
    <div class="modal-content" onclick="event.stopPropagation()" style="
          max-width: 600px;
          width: 90%;
          max-height: 90vh;
          overflow: hidden;
          display: flex;
          flex-direction: column;
          padding: 0;
          margin: auto;
        ">
      <div class="modal-header" style="
            padding: 20px 20px 16px 20px;
            border-bottom: 1px solid rgba(255, 179, 0, 0.1);
            flex-shrink: 0;
          ">
        <h3>Edit Booking</h3>
        <button class="close-modal-btn" onclick="closeEditBookingModal()">
          âœ•
        </button>
      </div>
      <div class="modal-body" style="
            max-height: calc(90vh - 80px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px 16px;
            flex: 1;
          ">
        <input type="hidden" id="editBookingId" />

        <!-- Trip Type Toggle -->
        <div class="form-section">
          <div class="trip-type-toggle">
            <button type="button" class="trip-option" id="editBookingOneWay"
              onclick="toggleEditBookingTripType('one-way')">
              One Way
            </button>
            <button type="button" class="trip-option" id="editBookingRoundTrip"
              onclick="toggleEditBookingTripType('round-trip')">
              Round Trip
            </button>
          </div>
        </div>

        <!-- Vehicle Type Selection -->
        <div class="form-section">
          <label class="section-label">Select Vehicle Type</label>
          <div class="vehicle-types">
            <button type="button" class="vehicle-option" onclick="selectEditBookingVehicle('sedan')"
              data-vehicle="sedan">
              <span class="vehicle-icon">ğŸš™</span>
              <span>Sedan</span>
            </button>
            <button type="button" class="vehicle-option" onclick="selectEditBookingVehicle('hatchback')"
              data-vehicle="hatchback">
              <span class="vehicle-icon">ğŸš</span>
              <span>Hatchback</span>
            </button>
            <button type="button" class="vehicle-option" onclick="selectEditBookingVehicle('suv')" data-vehicle="suv">
              <span class="vehicle-icon">ğŸš—</span>
              <span>SUV</span>
            </button>
            <button type="button" class="vehicle-option" onclick="selectEditBookingVehicle('traveller')"
              data-vehicle="traveller">
              <span class="vehicle-icon">ğŸšŒ</span>
              <span>Traveller</span>
            </button>
            <button type="button" class="vehicle-option" onclick="selectEditBookingVehicle('bus')" data-vehicle="bus">
              <span class="vehicle-icon">ğŸš</span>
              <span>Bus</span>
            </button>
            <button type="button" class="vehicle-option" onclick="selectEditBookingVehicle('luxury')"
              data-vehicle="luxury">
              <span class="vehicle-icon">âœ¨</span>
              <span>Luxury</span>
            </button>
          </div>
        </div>

        <!-- Date & Time -->
        <div class="form-section">
          <label class="section-label">Select Date & Time</label>
          <div class="date-time-row">
            <div class="input-group">
              <span class="input-icon">ğŸ“…</span>
              <input type="date" id="editBookingDate" class="form-input date-input" />
            </div>
            <div class="input-group">
              <span class="input-icon">ğŸ•</span>
              <input type="time" id="editBookingTime" class="form-input time-input" />
            </div>
          </div>
        </div>

        <!-- Pickup & Drop Locations -->
        <div class="form-section">
          <label class="section-label">Pickup & Drop Locations</label>
          <div class="location-row">
            <div class="input-group">
              <span class="input-icon">ğŸ“</span>
              <select id="editPickupCity" class="form-input">
                <option value="">Select Pickup City</option>
              </select>
            </div>
            <div class="input-group">
              <span class="input-icon">ğŸ“</span>
              <select id="editDropCity" class="form-input">
                <option value="">Select Drop City</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Amount Field -->
        <div class="form-section">
          <div class="location-row">
            <div class="input-group">
              <label class="input-label">Amount Driver Will Get</label>
              <div class="amount-input-wrapper">
                <span class="currency">â‚¹</span>
                <input type="number" id="editBookingAmount" class="form-input amount-input" placeholder="0" min="0" />
              </div>
            </div>
            <div style="margin-top: 40px;" class="input-group">
              <button type="button" class="submit-button" onclick="submitBookingEdit()" id="editBookingSubmitBtn">
                Update Booking
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Support Modal -->
  <div class="support-modal" id="supportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Support & Help</h3>
        <button class="close-modal" onclick="closeSupportModal()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <div class="support-option" onclick="contactSupport()">
          <span class="support-option-icon">ğŸ’¬</span>
          <div>
            <h4>Live Chat</h4>
            <p>Get instant help from our support team</p>
          </div>
        </div>
        <div class="support-option" onclick="whatsappSupport()">
          <span class="support-option-icon">ğŸ“±</span>
          <div>
            <h4>WhatsApp</h4>
            <p>Chat with us on WhatsApp</p>
          </div>
        </div>
        <div class="support-option" onclick="callSupport()">
          <span class="support-option-icon">ğŸ“</span>
          <div>
            <h4>Call Us</h4>
            <p>+91-9103774717</p>
          </div>
        </div>
        <div class="support-option" onclick="emailSupport()">
          <span class="support-option-icon">âœ‰ï¸</span>
          <div>
            <h4>Email</h4>
            <p>support@tripeaztaxi.com</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Bot Floater -->
  <div class="chatbot-floater" onclick="toggleChatbot()">
    <span class="chatbot-icon">ğŸ’¬</span>
  </div>

  <!-- FAB Popup Menu -->
  <div class="fab-popup-overlay" id="fabPopupOverlay" onclick="closeFABPopup()">
    <div class="fab-popup-menu" onclick="event.stopPropagation()">
      <div class="fab-popup-option" onclick="handleUploadBooking()">
        <span class="fab-option-icon">ğŸ“„</span>
        <span class="fab-option-label">Upload New Booking</span>
      </div>
      <div class="fab-popup-option cancel" onclick="closeFABPopup()">
        <span class="fab-option-icon">âœ•</span>
        <span class="fab-option-label">Cancel</span>
      </div>
    </div>
  </div>

  <!-- Chat Bot Window -->
  <div class="chatbot-window" id="chatbotWindow">
    <div class="chatbot-header">
      <h3>Customer Support</h3>
      <button class="close-chatbot-btn" onclick="toggleChatbot()" aria-label="Close chat">
        âœ•
      </button>
    </div>
    <div class="chatbot-messages" id="chatbotMessages">
      <div class="chat-message bot-message">
        <p>Hello! ğŸ‘‹ Welcome to Tripeaz Taxi Partners</p>
      </div>
    </div>
    <div class="chatbot-input-container">
      <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Type your message..."
        onkeypress="handleChatInput(event)" />
      <button class="chatbot-send-btn" onclick="sendChatMessage()">
        <span class="send-icon">ğŸ“¤</span>
      </button>
    </div>
  </div>

  <!-- Success Toast -->
  <div class="toast" id="successToast">
    <div class="toast-content">
      <span class="toast-icon">âœ…</span>
      <span class="toast-message" id="toastMessage">Success!</span>
    </div>
  </div>

  <script src="../js/services/api.js"></script>
  <script src="../js/pages/dashboard.js"></script>
  <script src="../js/pages/my-bookings.js"></script>
</body>

</html>